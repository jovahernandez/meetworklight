================================================================================
  ITERACIÃ“N 4: Avisos al Reclutador sobre Vigencia de Vacantes
  Fecha: 23 de enero de 2025
================================================================================

OBJETIVO:
Convertir la informaciÃ³n de vigencia existente (validityDays, expiresAt, estados)
en un flujo de avisos in-app para que el RH gestione proactivamente sus vacantes.

NO se implementan emails automÃ¡ticos (solo hooks para IteraciÃ³n 5).
NO se modificÃ³ lÃ³gica de negocio de vigencia (solo UX).
NO se tocÃ³ KYC, tÃ©rminos, seguridad ni Iteraciones 1, 2, 3 y 3.1.

================================================================================
1. CAMBIOS EN DASHBOARD DEL RECLUTADOR (/recruiter/jobs)
================================================================================

A) SECCIÃ“N DE AVISOS (NUEVO - PARTE SUPERIOR DEL DASHBOARD)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Se agregÃ³ una mini secciÃ³n ENCIMA del listado de vacantes que funciona como
"centro de avisos" de vigencia. Muestra automÃ¡ticamente el estado mÃ¡s urgente.

ESCENARIO 1: Reclutador con vacantes EXPIRADAS
-----------------------------------------------
Prioridad: ALTA (se muestra este bloque aunque tambiÃ©n tenga "por expirar")

Componente:
- Card con borde rojo (border-red-300) y fondo rojo claro (bg-red-50)
- Icono: ğŸ”´
- TÃ­tulo: "Vacantes Expiradas"
- Mensaje: "Tienes N vacante(s) expirada(s) que ya no se muestra(n) a los candidatos."

Contenido:
- Lista de mÃ¡ximo 3 vacantes expiradas
- Para cada vacante:
  * TÃ­tulo del puesto
  * "Expirada hace X dÃ­as" (calculado como abs(daysLeft))
  * BotÃ³n "Renovar" â†’ lleva a /recruiter/jobs/[id]/edit

- Si hay mÃ¡s de 3 expiradas:
  * Texto: "+ X vacante(s) expirada(s) mÃ¡s"

ESCENARIO 2: Reclutador SIN expiradas pero CON vacantes POR EXPIRAR
--------------------------------------------------------------------
Prioridad: MEDIA (solo se muestra si NO hay expiradas)

Componente:
- Card con borde naranja (border-orange-300) y fondo naranja claro (bg-orange-50)
- Icono: âš ï¸
- TÃ­tulo: "Vacantes Por Expirar"
- Mensaje: "Tienes N vacante(s) que expira(n) en los prÃ³ximos 3 dÃ­as."

Contenido:
- Lista de mÃ¡ximo 3 vacantes por expirar (daysLeft 0-3)
- Para cada vacante:
  * TÃ­tulo del puesto
  * "Expira en X dÃ­as"
  * BotÃ³n "Extender Vigencia" â†’ lleva a /recruiter/jobs/[id]/edit

- Si hay mÃ¡s de 3 por expirar:
  * Texto: "+ X vacante(s) por expirar mÃ¡s"

ESCENARIO 3: Reclutador SIN problemas de vigencia
--------------------------------------------------
Prioridad: BAJA (solo se muestra si todo estÃ¡ OK)

Componente:
- Card con borde verde (border-green-200) y fondo verde claro (bg-green-50)
- Icono: âœ…
- Mensaje: "Todas tus vacantes vigentes estÃ¡n dentro de su periodo de publicaciÃ³n."

ESCENARIO 4: Reclutador sin vacantes
-------------------------------------
NO se muestra ningÃºn bloque de avisos (se mantiene el mensaje de "No tienes vacantes").

IMPLEMENTACIÃ“N:
- Se agregÃ³ funciÃ³n getValidityAlerts() que filtra jobs por estado
- Calcula: validityAlerts.expired y validityAlerts.expiringSoon
- Renderizado condicional segÃºn prioridad (expired > expiring_soon > all_ok)
- NO se hacen queries adicionales (reutiliza datos ya cargados)


B) BOTONES CTA EN CARDS DE VACANTES (MEJORADO)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ANTES (IteraciÃ³n 3):
- Solo botÃ³n "Ver Detalles" para todas las vacantes

AHORA (IteraciÃ³n 4):
- Estado EXPIRED:
  * BotÃ³n primario: "Renovar Vacante" â†’ /recruiter/jobs/[id]/edit
  * BotÃ³n secundario: "Ver Detalles" â†’ /recruiter/jobs/[id]

- Estado EXPIRING_SOON:
  * BotÃ³n primario: "Extender Vigencia" â†’ /recruiter/jobs/[id]/edit
  * BotÃ³n secundario: "Ver Detalles" â†’ /recruiter/jobs/[id]

- Estado ACTIVE (o sin vigencia):
  * BotÃ³n: "Ver Detalles" â†’ /recruiter/jobs/[id]

NOTA IMPORTANTE:
- "Renovar" y "Extender Vigencia" NO implementan lÃ³gica especial
- Son simplemente aliases visuales para "Editar vacante"
- La "renovaciÃ³n" sigue siendo: editar la vacante y ajustar el slider de vigencia
- El backend recalcula expiresAt desde HOY cuando se edita validityDays


C) MENSAJES DE ADVERTENCIA MEJORADOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ANTES (IteraciÃ³n 3):
- Expired: "Esta vacante ya no se muestra a los candidatos"
- Expiring Soon: "Tu vacante expira en X dÃ­as. ActualÃ­zala o se desactivarÃ¡"

AHORA (IteraciÃ³n 4):
- Expired:
  "Esta vacante ya no se muestra a los candidatos. Edita y renueva la vigencia si aÃºn estÃ¡ disponible."
  (MÃ¡s accionable, sugiere quÃ© hacer)

- Expiring Soon:
  "Tu vacante expira en X dÃ­as. Si sigue abierta, actualiza la vigencia para que no desaparezca de los resultados."
  (MÃ¡s contextual, explica la consecuencia)

- Active:
  Sin mensaje (solo badge "ğŸ“… X dÃ­as restantes")

IMPLEMENTACIÃ“N:
- Se modificÃ³ funciÃ³n getJobStatus() con nuevos textos
- NO se cambiÃ³ lÃ³gica de cÃ¡lculo de daysLeft
- NO se cambiÃ³ clasificaciÃ³n de estados (expired/expiring_soon/active)


D) LÃ“GICA DE NEGOCIO SIN CAMBIOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MANTENIDO EXACTAMENTE IGUAL QUE ITERACIÃ“N 3/3.1:
âœ… CÃ¡lculo de daysLeft: Math.ceil((expiresAt - today) / milisegundos)
âœ… Estados:
   - expired: daysLeft < 0
   - expiring_soon: daysLeft >= 0 AND daysLeft <= 3
   - active: daysLeft > 3 OR expiresAt = null
âœ… Badges visuales (colores, iconos)
âœ… Filtro de bÃºsqueda para candidatos (no tocado)
âœ… LÃ³gica de ediciÃ³n y recÃ¡lculo de expires_at (no tocada)

================================================================================
2. RESUMEN DE CÃLCULO Y VISUALIZACIÃ“N
================================================================================

FLUJO DE INFORMACIÃ“N:

1) fetchJobs() trae todas las vacantes del reclutador desde /api/recruiter/jobs

2) Para cada vacante, se calcula getJobStatus(job):
   - Si job.expiresAt = null â†’ status: 'active', daysLeft: null
   - Si job.expiresAt existe:
     * daysLeft = Math.ceil((expiresAt - hoy) / milisegundos)
     * Si daysLeft < 0 â†’ 'expired'
     * Si 0 <= daysLeft <= 3 â†’ 'expiring_soon'
     * Si daysLeft > 3 â†’ 'active'

3) getValidityAlerts() filtra vacantes:
   - expired = jobs donde getJobStatus(job).status === 'expired'
   - expiringSoon = jobs donde getJobStatus(job).status === 'expiring_soon'

4) Renderizado de secciÃ³n de avisos (top del dashboard):
   - Si expired.length > 0 â†’ Bloque rojo con lista de mÃ¡x 3 expiradas
   - Else si expiringSoon.length > 0 â†’ Bloque naranja con lista de mÃ¡x 3 por expirar
   - Else â†’ Bloque verde "Todo OK"

5) Renderizado de cada card de vacante:
   - Badges: Activa/Inactiva + (Expirada/Por expirar/X dÃ­as restantes)
   - Mensaje de advertencia si expired o expiring_soon
   - Botones CTA segÃºn estado

DATOS MOSTRADOS:

N Vacantes Expiradas:
- CÃ¡lculo: validityAlerts.expired.length
- Mostradas: mÃ¡ximo 3 en bloque rojo
- Para cada una: tÃ­tulo, "Expirada hace X dÃ­as", botÃ³n "Renovar"
- X = abs(daysLeft) para las expiradas

N Vacantes Por Expirar:
- CÃ¡lculo: validityAlerts.expiringSoon.length
- Mostradas: mÃ¡ximo 3 en bloque naranja
- Para cada una: tÃ­tulo, "Expira en X dÃ­as", botÃ³n "Extender Vigencia"
- X = daysLeft (0, 1, 2 o 3)

Sin Problemas:
- CondiciÃ³n: expired.length = 0 AND expiringSoon.length = 0
- Mensaje: "Todas tus vacantes vigentes estÃ¡n dentro de su periodo..."

================================================================================
3. CONFIRMACIÃ“N: LÃ“GICA DE NEGOCIO NO MODIFICADA
================================================================================

NO SE TOCÃ“:

âœ… CÃ¡lculo de expires_at en CreateJobPosting y UpdateJobPosting
âœ… ValidaciÃ³n de validityDays (7-30 dÃ­as)
âœ… FÃ³rmula: expires_at = hoy + (validityDays * 24 * 60 * 60 * 1000)
âœ… Filtro en /api/jobs para buscadores: (expires_at IS NULL OR expires_at >= hoy)
âœ… Repositorio SupabaseJobPostingRepository (findAll, mapToEntity, create, update)
âœ… Migraciones de BD (20250123000003_add_job_validity_fields.sql)
âœ… Dominio JobPosting (expiresAt: Date | null, validityDays: number)
âœ… DTOs CreateJobPostingDTO y UpdateJobPostingDTO
âœ… Formularios de creaciÃ³n/ediciÃ³n (/recruiter/jobs/new, /recruiter/jobs/[id]/edit)

SOLO SE MODIFICÃ“:

ğŸ“ src/app/recruiter/jobs/page.tsx:
   - Textos de mensajes de advertencia (mÃ¡s claros)
   - Agregada secciÃ³n de avisos arriba del listado
   - Agregados botones "Renovar" y "Extender Vigencia"
   - Agregada funciÃ³n getValidityAlerts()

================================================================================
4. DEFINICIÃ“N DE INotificationService Y DummyNotificationService
================================================================================

PUERTO: src/ports/services/INotificationService.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Interfaz que define el contrato para servicios de notificaciÃ³n.

MÃ©todos:

1) notifyJobExpiringSoon(userId, jobPostingId, daysLeft): Promise<void>
   - ParÃ¡metros:
     * userId: string - UUID del reclutador (Supabase Auth UID)
     * jobPostingId: string - UUID de la vacante
     * daysLeft: number - DÃ­as restantes (0-3)
   - PropÃ³sito: Notificar que una vacante estÃ¡ por expirar
   - TODO IteraciÃ³n 5: Enviar email "Tu vacante [TÃ­tulo] expira en X dÃ­as"

2) notifyJobExpired(userId, jobPostingId): Promise<void>
   - ParÃ¡metros:
     * userId: string - UUID del reclutador
     * jobPostingId: string - UUID de la vacante
   - PropÃ³sito: Notificar que una vacante ha expirado
   - TODO IteraciÃ³n 5: Enviar email "Tu vacante [TÃ­tulo] ha expirado"

DocumentaciÃ³n incluye:
- Ejemplos de uso
- Plan de integraciÃ³n para IteraciÃ³n 5 (3 opciones: Edge Functions, Vercel Cron, pg_cron)
- RecomendaciÃ³n: Vercel Cron (mÃ¡s simple para empezar)


IMPLEMENTACIÃ“N DUMMY: src/infrastructure/services/DummyNotificationService.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Implementa INotificationService con lÃ³gica placeholder.

Comportamiento actual:
- notifyJobExpiringSoon() â†’ console.log con formato estructurado
- notifyJobExpired() â†’ console.log con formato estructurado
- Simula delay de red: await setTimeout(100ms)
- NO envÃ­a emails reales
- NO se llama automÃ¡ticamente desde ningÃºn CRON ni webhook

Output de ejemplo:

========================================
[DUMMY NOTIFICATION] Vacante por expirar
========================================
Usuario:      uuid-reclutador
Vacante ID:   uuid-vacante
DÃ­as restantes: 2
AcciÃ³n:       Enviar email "Tu vacante expira pronto"
TODO:         Implementar EmailNotificationService en IteraciÃ³n 5
========================================

Uso:
- Puede invocarse manualmente para testing/debugging
- Se puede integrar en use cases si se desea logging
- Listo para reemplazar con EmailNotificationService en IteraciÃ³n 5

================================================================================
5. PLAN PARA ITERACIÃ“N 5 (EMAILS AUTOMÃTICOS)
================================================================================

OBJETIVO ITERACIÃ“N 5:
Implementar envÃ­o automÃ¡tico de emails a reclutadores cuando sus vacantes
estÃ©n por expirar o hayan expirado.

OPCIÃ“N RECOMENDADA: Vercel Cron Jobs
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PASO 1: Crear API route para cron job
--------------------------------------
Archivo: src/app/api/cron/check-expiring-jobs/route.ts

LÃ³gica:
1. Verificar header x-vercel-cron (seguridad)
2. Consultar BD:
   - Vacantes donde expires_at BETWEEN hoy AND hoy+3 dÃ­as
   - Vacantes donde expires_at = hoy-1 dÃ­a (reciÃ©n expiradas)
3. Para cada vacante, verificar si ya se enviÃ³ notificaciÃ³n (evitar duplicados)
4. Llamar EmailNotificationService.notifyJobExpiringSoon() o notifyJobExpired()
5. Guardar log de notificaciÃ³n enviada

PASO 2: Configurar cron en vercel.json
---------------------------------------
{
  "crons": [
    {
      "path": "/api/cron/check-expiring-jobs",
      "schedule": "0 9 * * *"
    }
  ]
}

Esto ejecuta el cron diariamente a las 9:00 AM (hora del servidor).

PASO 3: Implementar EmailNotificationService
---------------------------------------------
Archivo: src/infrastructure/services/EmailNotificationService.ts

Implementa INotificationService con:
- IntegraciÃ³n con Resend API, SendGrid o similar
- Templates HTML para emails
- Rate limiting (no enviar mismo email mÃºltiples veces)
- Manejo de errores y reintentos

Ejemplo con Resend:
```typescript
import { Resend } from 'resend';

export class EmailNotificationService implements INotificationService {
  private resend = new Resend(process.env.RESEND_API_KEY);

  async notifyJobExpiringSoon(userId, jobPostingId, daysLeft) {
    // Obtener datos del usuario y vacante
    const user = await getUserById(userId);
    const job = await getJobById(jobPostingId);

    await this.resend.emails.send({
      from: 'MeetWork <noreply@meetwork.com>',
      to: user.email,
      subject: `Tu vacante "${job.title}" expira en ${daysLeft} dÃ­as`,
      html: renderExpiringSoonTemplate(job, daysLeft)
    });
  }
}
```

PASO 4: Crear tabla de logs de notificaciones
----------------------------------------------
Migration: 20250XXX_create_notification_logs.sql

```sql
CREATE TABLE notification_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  job_posting_id UUID NOT NULL REFERENCES job_postings(id),
  notification_type VARCHAR(50) NOT NULL, -- 'expiring_soon' | 'expired'
  sent_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(job_posting_id, notification_type, sent_at::date)
);
```

Esto evita enviar el mismo email varias veces el mismo dÃ­a.

PASO 5: Testing
---------------
1. Crear vacante de prueba con expires_at = hoy+2 dÃ­as
2. Esperar ejecuciÃ³n del cron (o llamar manualmente el endpoint)
3. Verificar recepciÃ³n de email
4. Confirmar log en notification_logs

ALTERNATIVAS:

OpciÃ³n B: Supabase Database Webhooks + Edge Functions
- Ventaja: ReacciÃ³n en tiempo real a cambios en BD
- Desventaja: MÃ¡s complejo de configurar y debuggear

OpciÃ³n C: Supabase pg_cron
- Ventaja: Todo en BD, no depende de servidor externo
- Desventaja: Requiere plan Pro de Supabase, menos flexible

RECOMENDACIÃ“N FINAL:
Empezar con Vercel Cron (OpciÃ³n A). Es simple, debuggeable, y completamente
controlado desde Next.js. Si crece mucho el volumen, migrar a sistema de colas.

================================================================================
6. GUÃA DE PRUEBAS MANUALES
================================================================================

CASO A: RECLUTADOR SIN VACANTES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Pasos:
1. Crear cuenta de reclutador nueva (sin vacantes)
2. Navegar a /recruiter/jobs

Resultado esperado:
âœ… NO se muestra secciÃ³n de avisos
âœ… Se muestra card "No tienes vacantes publicadas"
âœ… BotÃ³n "Crear Primera Vacante"


CASO B: RECLUTADOR SOLO CON VACANTES ACTIVAS (SIN PROBLEMAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Setup:
1. Crear 2-3 vacantes con vigencia de 15-30 dÃ­as
2. Asegurar que todas tienen expires_at > hoy+3 dÃ­as

Pasos:
1. Navegar a /recruiter/jobs

Resultado esperado:
âœ… Bloque verde: "Todas tus vacantes vigentes estÃ¡n dentro de su periodo..."
âœ… Cada card muestra:
   - Badge "Activa" (verde)
   - Badge "ğŸ“… X dÃ­as restantes" (azul)
   - SIN mensaje de advertencia
   - Solo botÃ³n "Ver Detalles"


CASO C: RECLUTADOR CON 1-2 VACANTES POR EXPIRAR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Setup:
1. En Supabase SQL Editor:
   ```sql
   UPDATE job_postings 
   SET expires_at = CURRENT_DATE + INTERVAL '2 days',
       validity_days = 2
   WHERE id = 'uuid-vacante-1';

   UPDATE job_postings 
   SET expires_at = CURRENT_DATE + INTERVAL '1 day',
       validity_days = 1
   WHERE id = 'uuid-vacante-2';
   ```

Pasos:
1. Navegar a /recruiter/jobs

Resultado esperado:
âœ… Bloque naranja (top): "Vacantes Por Expirar"
âœ… Mensaje: "Tienes 2 vacantes que expiran en los prÃ³ximos 3 dÃ­as."
âœ… Lista muestra mÃ¡ximo 3 vacantes con:
   - TÃ­tulo de la vacante
   - "Expira en 2 dÃ­as" / "Expira en 1 dÃ­a"
   - BotÃ³n "Extender Vigencia"
âœ… Cada card en el listado muestra:
   - Badge "âš ï¸ Por expirar" (naranja)
   - Mensaje naranja: "Tu vacante expira en X dÃ­as. Si sigue abierta..."
   - BotÃ³n primario "Extender Vigencia"
   - BotÃ³n secundario "Ver Detalles"

Verificar funcionalidad:
1. Click en "Extender Vigencia" (desde bloque naranja o card)
2. âœ… Redirige a /recruiter/jobs/[id]/edit
3. Ajustar slider de vigencia a 20 dÃ­as
4. Guardar
5. âœ… Volver a dashboard
6. âœ… Vacante ahora muestra "ğŸ“… 20 dÃ­as restantes"
7. âœ… Ya NO aparece en bloque naranja


CASO D: RECLUTADOR CON VACANTES EXPIRADAS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Setup:
1. En Supabase SQL Editor:
   ```sql
   UPDATE job_postings 
   SET expires_at = CURRENT_DATE - INTERVAL '2 days',
       validity_days = 7
   WHERE id = 'uuid-vacante-1';

   UPDATE job_postings 
   SET expires_at = CURRENT_DATE - INTERVAL '5 days',
       validity_days = 10
   WHERE id = 'uuid-vacante-2';

   UPDATE job_postings 
   SET expires_at = CURRENT_DATE - INTERVAL '1 day',
       validity_days = 7
   WHERE id = 'uuid-vacante-3';
   ```

Pasos:
1. Navegar a /recruiter/jobs

Resultado esperado:
âœ… Bloque rojo (top): "Vacantes Expiradas"
âœ… Mensaje: "Tienes 3 vacantes expiradas que ya no se muestran a los candidatos."
âœ… Lista muestra mÃ¡ximo 3 con:
   - TÃ­tulo de la vacante
   - "Expirada hace 2 dÃ­as" / "Expirada hace 5 dÃ­as" / "Expirada hace 1 dÃ­a"
   - BotÃ³n "Renovar"
âœ… Si hubiera 4+ expiradas: "+ X vacante(s) expirada(s) mÃ¡s"

âœ… Cada card en el listado muestra:
   - Badge "ğŸ”´ Expirada" (rojo)
   - Mensaje rojo: "Esta vacante ya no se muestra... Edita y renueva..."
   - BotÃ³n primario "Renovar Vacante"
   - BotÃ³n secundario "Ver Detalles"

Verificar funcionalidad:
1. Click en "Renovar" (desde bloque rojo o card)
2. âœ… Redirige a /recruiter/jobs/[id]/edit
3. Ajustar slider de vigencia a 15 dÃ­as
4. Guardar
5. âœ… Volver a dashboard
6. âœ… Vacante ahora muestra "ğŸ“… 15 dÃ­as restantes"
7. âœ… Ya NO aparece en bloque rojo
8. âœ… expires_at se recalculÃ³ desde HOY (no desde fecha original)

Verificar filtrado para candidatos:
1. Navegar a /jobs (bÃºsqueda pÃºblica)
2. âœ… Las vacantes expiradas NO aparecen en resultados
3. Renovar una vacante (ajustar vigencia)
4. Refrescar /jobs
5. âœ… Ahora SÃ aparece en resultados


CASO E: CONFIRMAR QUE BOTONES LLEVAN A EDICIÃ“N CORRECTA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Pasos:
1. Desde dashboard, click en "Renovar Vacante" de una expirada
2. âœ… URL: /recruiter/jobs/[id-correcto]/edit
3. âœ… Formulario carga datos de la vacante correcta
4. âœ… Slider de vigencia muestra valor actual o default 30

5. Volver a dashboard, click en "Extender Vigencia" de una por expirar
6. âœ… URL: /recruiter/jobs/[id-correcto]/edit
7. âœ… Formulario carga datos correctos

8. Volver a dashboard, click en "Ver Detalles" de cualquier vacante
9. âœ… URL: /recruiter/jobs/[id-correcto]
10. âœ… Vista de detalle muestra informaciÃ³n completa


CASO F: PRIORIDAD DE BLOQUES DE AVISOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Setup:
1. Tener 2 vacantes expiradas
2. Tener 1 vacante por expirar

Resultado esperado:
âœ… Solo se muestra bloque rojo (expiradas)
âœ… NO se muestra bloque naranja (aunque haya vacantes por expirar)
âœ… LÃ³gica: Prioridad ALTA (expired) > MEDIA (expiring_soon) > BAJA (all_ok)

Verificar:
1. Renovar las 2 expiradas
2. Refrescar dashboard
3. âœ… Ahora SÃ se muestra bloque naranja (por expirar)

4. Extender vigencia de la que estaba por expirar
5. Refrescar dashboard
6. âœ… Ahora se muestra bloque verde (todo OK)

================================================================================
7. RESUMEN FINAL
================================================================================

ARCHIVOS CREADOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… src/ports/services/INotificationService.ts (79 lÃ­neas)
   - Puerto hexagonal para servicio de notificaciones
   - MÃ©todos: notifyJobExpiringSoon, notifyJobExpired
   - DocumentaciÃ³n completa con plan de integraciÃ³n

âœ… src/infrastructure/services/DummyNotificationService.ts (68 lÃ­neas)
   - ImplementaciÃ³n dummy de INotificationService
   - Solo console.log, NO envÃ­a emails reales
   - Listo para reemplazar con EmailNotificationService

ARCHIVOS MODIFICADOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… src/app/recruiter/jobs/page.tsx
   - Agregada funciÃ³n getValidityAlerts()
   - Agregada secciÃ³n de avisos (bloques rojo/naranja/verde)
   - Mejorados mensajes de advertencia (mÃ¡s claros)
   - Agregados botones CTA: "Renovar Vacante", "Extender Vigencia"
   - Renderizado condicional segÃºn prioridad de avisos

ARCHIVOS NO TOCADOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Migraciones de BD (IteraciÃ³n 3)
âœ… Dominio JobPosting (IteraciÃ³n 3.1)
âœ… DTOs CreateJobPostingDTO, UpdateJobPostingDTO (IteraciÃ³n 3.1)
âœ… Use cases CreateJobPosting, UpdateJobPosting (IteraciÃ³n 3.1)
âœ… Repository SupabaseJobPostingRepository (IteraciÃ³n 3.1)
âœ… Formularios /recruiter/jobs/new y /recruiter/jobs/[id]/edit (IteraciÃ³n 3)
âœ… BÃºsqueda pÃºblica /jobs y /api/jobs (IteraciÃ³n 3.1)
âœ… KYC, TÃ©rminos, Seguridad (Iteraciones 1 y 2)

LÃ“GICA DE NEGOCIO SIN CAMBIOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… CÃ¡lculo de expires_at: hoy + (validityDays * 86400000 ms)
âœ… ValidaciÃ³n de validityDays: 7-30 dÃ­as
âœ… Estados: expired (< 0), expiring_soon (0-3), active (> 3 o null)
âœ… Filtro para candidatos: (expires_at IS NULL OR expires_at >= hoy)
âœ… RecÃ¡lculo desde HOY al editar validityDays

FUNCIONALIDAD AGREGADA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Bloque rojo: Vacantes expiradas (muestra max 3, prioridad ALTA)
âœ… Bloque naranja: Vacantes por expirar (muestra max 3, prioridad MEDIA)
âœ… Bloque verde: Todo OK (prioridad BAJA)
âœ… BotÃ³n "Renovar Vacante" para expiradas â†’ ediciÃ³n
âœ… BotÃ³n "Extender Vigencia" para por expirar â†’ ediciÃ³n
âœ… Mensajes mejorados y mÃ¡s accionables
âœ… Interface INotificationService (ready para IteraciÃ³n 5)
âœ… DummyNotificationService (placeholder para testing)

PRÃ“XIMOS PASOS (ITERACIÃ“N 5):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Implementar EmailNotificationService con Resend/SendGrid
2. Crear API route /api/cron/check-expiring-jobs
3. Configurar Vercel Cron en vercel.json (diario 9:00 AM)
4. Crear tabla notification_logs para evitar duplicados
5. DiseÃ±ar templates HTML para emails
6. Testing completo de flujo de emails automÃ¡ticos

NOTAS TÃ‰CNICAS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- getValidityAlerts() NO hace queries adicionales (reutiliza datos cargados)
- Prioridad de bloques: expired > expiring_soon > all_ok
- Botones "Renovar/Extender" son aliases de "Editar" (sin lÃ³gica nueva)
- RecÃ¡lculo de expires_at siempre desde HOY (no extiende desde fecha original)
- SecciÃ³n de avisos solo se muestra si hay jobs (no en estado vacÃ­o)

================================================================================
FIN DEL RESUMEN - ITERACIÃ“N 4
================================================================================
